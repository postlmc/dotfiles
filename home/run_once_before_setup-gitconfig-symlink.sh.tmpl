#!/bin/bash

{{- $hostname := .chezmoi.hostname | lower }}
{{- $hostnameParts := splitList "." $hostname }}
{{- $shortHostname := index $hostnameParts 0 }}
{{- $localGitconfig := joinPath .chezmoi.homeDir ".dotfiles.local" (printf "%s-gitconfig" $shortHostname) }}
{{- $fallbackGitconfig := joinPath .chezmoi.homeDir ".dotfiles/gitconfig" }}
{{- $targetSymlink := joinPath .chezmoi.homeDir ".gitconfig" }}

# Remove existing symlink if it exists
rm -f "{{ $targetSymlink }}"

# Create symlink to appropriate target
if [ -f "{{ $localGitconfig }}" ]; then
    ln -s "{{ $localGitconfig }}" "{{ $targetSymlink }}"
else
    ln -s "{{ $fallbackGitconfig }}" "{{ $targetSymlink }}"
fi
